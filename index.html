<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Value Machine</title>
<style>
    body {
        font-family: "Times New Roman", serif;
        background: black url(https://media.xanje.com/themes/dark/background.png);
        color: #b8b8b8;
        padding: 20px;
        max-width: 800px;
        margin: auto;
    }
    hr {
        background: url(https://64.media.tumblr.com/3a8d46bc9b57b88635bf6c59ab115b2f/f6f0cf0e0901b6dd-ca/s400x600/37e660e49e362f3611d3dbedbc79f95d2b7f37f2.gif) center no-repeat;
        border: none;
        height: 1px;
        background-size: 100%;
        box-shadow: 2px 2px 5px rgba(255, 255, 255, 0.5);
    }
    h1 { 
        text-align: center;
        color: #b8b8b8;
    }
    h4 {
        text-align: center;
        color: #b8b8b8;
    }
    .box {
        background: #171717;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 10px;
    }
    .market-grid {
        display: flex;
        gap: 1rem; /* space between the labels */
        flex-wrap: wrap; /* optional, wraps if the screen is too narrow */
    }
    .market-grid label {
        display: flex;
        flex-direction: column; /* keeps the text above the input */
    }
    label { display: block; margin-top: 10px; }
    input, select {
        background: #15212a;
        color: #c5c5c5;
        padding: 6px;
        margin-top: 3px;
        font-size: 16px;
        border: none;
        border-radius: 10px;
    }
    .extras-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 6px;
        margin-top: 10px;
    }
    button {
        width: 100%;
        padding: 12px;
        margin-top: 20px;
        font-size: 18px;
        background: #15212a;
        color: #b8b8b8;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
    button:hover { background: #15212a; }
    pre {
        background: #15212a;
        padding: 15px;
        border-radius: 10px;
        white-space: pre-wrap;
    }
    .details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
    .details-grid .full {
        grid-column: 1 / -1;
}
    .details-row-3 {
        display: grid;
       grid-template-columns: repeat(3, 1fr);
       gap: 12px;
}
</style>
</head>
<body>
<h1>Value Machine</h1>
<div class="box">
    <h2>Pet Value Calculator</h2>
    <h4>Market value(if any)</h4>
    <div class="market-grid">
    <label>
        Sales (past 7 days)
        <input id="market7" type="number" value="0">
    </label>
    <label>
        Sales (past 30 days)
        <input id="market30" type="number" value="0">
    </label>
    <label>
        Current Listings
        <input id="marketCurrent" type="number" value="0">
    </label>
</div>
<hr>
    <h4>Details</h4>
<div class="details-grid">
    <div>
        <label>Category</label>
        <select id="category">
            <option>Main</option>
            <option>Stray</option>
            <option>Battle</option>
            <option>Premium</option>
            <option>Seasonal</option>
            <option>Orphan</option>
            <option>Greystone</option>
            <option>Redstone</option>
            <option>Redstone(2)</option>
            <option>Redstone(4)</option>
            <option>Quest/Award</option>
            <option value="CUSTOM">Custom</option>
        </select>
    </div>
    <div id="customBaseWrapper" style="display:none;">
        <label>Custom Value (coins)</label>
        <input id="customBase" type="number" value="0">
    </div>
    <div class="details-row-3 full">
        <div>
            <label>
                Generation
                <abbr title="If the pet is G1, use the G1 population from the library. Otherwise use total.">?</abbr>
            </label>
            <input id="generation" type="number" value="1">
        </div>

        <div>
            <label>
                Birthdate
                <abbr title="To see a pet's birthdate, go to your pet's page > click on where it says x days/month/years ago.">?</abbr>
            </label>
            <input id="birthdate" type="date">
        </div>
        <div>
            <label>Population</label>
            <input id="population" type="number" value="100">
        </div>
    </div>
</div>


<label>Extras (select any):</label>
<div class="extras-grid">
    <label><input type="checkbox" value="Ethereal"> Ethereal <abbr title="Only applies to pets with ethereal/star attribute">?</abbr></label>
    <label><input type="checkbox" value="AllCarrier"> All Carrier <abbr title="Only applies to pets that carry all genes">?</abbr></label>
    <label><input type="checkbox" value="Parentless"> Parentless <abbr title="Only applies to G1 pets with no found parents">?</abbr></label>
    <label><input type="checkbox" value="Event"> Exclusive Attribute <abbr title="Pledged in crowdfunned, blessed by Yanne, cursed by Krora, kumforted, gift box exclusive, NOT for orphan effects or recolored pets">?</abbr></label>
    <label><input type="checkbox" value="BreedOnly"> Breed-Only Variant <abbr title="Only applies to mutations that can only be obtained through breeding">?</abbr></label>
    <label><input type="checkbox" value="Childless"> Childless(optional) <abbr title="For use if pets with no offspring are preferred.">?</abbr></label>
    <label><input type="checkbox" value="Effect"> Effect <abbr title="Only applies to pets from orphan releases that have an effect">?</abbr></label>
    <label><input type="checkbox" value="Manual"> Manual Breeding <abbr title="For G2+ pets with manual breeding(Common Cat, Persian Cat, some Palace Cats, some Star Cats)">?</abbr></label>
    <label><input type="checkbox" value="Ungrown"> Ungrown <abbr title="Mostly for use in 10+ year old pets. Increases 10+ year old pets, reduces 3- months old.">?</abbr></label>
    <label><input type="checkbox" value="Painted"> Painted <abbr title="Only applies to a pet has been colored in Carrie's">?</abbr></label>
    <label><input type="checkbox" value="Unbreedable"> Unbreedable <abbr title="Only applies to certain older pets that have unfinished linework and cannot be bred">?</abbr></label>
    <label><input type="checkbox" value="Glitched"> Glitched <abbr title="For most visible glitches, missing layers, etc">?</abbr></label>
    <label><input type="checkbox" value="Rare"> Rare <abbr title="Rare strays, rare coloring.">?</abbr></label>
</div>

    <button onclick="runCalc()">Calculate</button>
</div>

<div class="box">
    <h2>Results</h2>
    <pre id="output">Fill in values and click Calculate.</pre>
</div>

<script>
// ===============================
//  VALUE MACHINE — CORE LOGIC
// ===============================


// ---------- CATEGORY BASE COSTS ----------
const CATEGORY_BASE_COSTS = {
    "Redstone(4)": 3200000,
    "Redstone(2)": 1600000,
    "Redstone": 800000,
    "Greystone": 600000,
    "Battle": 50000,
    "Premium": 100000,
    "Seasonal": 100000,
    "Orphan": 25000,
    "Quest/Award": 80000,
    "Main": 5000,
    "Stray": 4000
};


// ---------- AGE CURVES ----------
const AGE_CURVES = {
    "Redstone":     { early: 0.045, late: 0.0095 },
    "Redstone(2)":  { early: 0.045, late: 0.0092 },
    "Redstone(4)":  { early: 0.045, late: 0.009 },
    "Greystone":    { early: 0.04,  late: 0.014 },
    "Battle":       { early: 0.035, late: 0.012 },
    "Premium":      { early: 0.03,  late: 0.01 },
    "Seasonal":     { early: 0.028, late: 0.012 },
    "Orphan":       { early: 0.025,  late: 0.011 },
    "Quest/Award":  { early: 0.02,  late: 0.005 },
    "Main":         { early: 0.035, late: 0.032 },
    "Stray":        { early: 0.035, late: 0.032 },
    "CUSTOM":       { early: 0.03,  late: 0.02 }
};


// ---------- EXTRA EFFECTS ----------
const EXTRA_EFFECTS = {
    Ethereal: { default: v => 4000000 },
    Glitched: { 
        default: v => v * 0.15 + 80000,
        "Main": v => v * 0.15 + 300000,
        "Orphan": v => v * 0.16 + 600000,
        "Stray": v => v * 0.18 + 450000    
    },
    Manual: { default: v => v * 0.25 },
    BreedOnly: { default: v => v * 0.20 },
    AllCarrier: { default: v => v * 0.99 },
    Event: { default: v => (v * 0.40) + 400000 },
    Painted: { default: v => 500000 },
    Rare: {
        default: v => v * 0.05,
        "Battle": v => v * 0.45 + 350000,
        "Orphan": v => v + 80000,
        "Stray": v => v + 20000
    },
    Effect: { default: v => v * 0.12 },
    Parentless: {
        default: v => v * 0.15,
        "Redstone": v => v * 0.16,
        "Redstone(2)": v => v * 0.17,
        "Redstone(4)": v => v * 0.18,
        "Quest/Award": v => v * 0.19,
        "Main": v => v * 0.20,
        "Battle": v => v * 0.21
    },
    Childless: { default: v => v * 0.10 },
    Ungrown: { default: v => 0 },
    Unbreedable: { default: v => 200000 }
};


// ===============================
//  HELPERS
// ===============================

function getBaseCost(category, customBase) {
    return category === "CUSTOM"
        ? customBase
        : (CATEGORY_BASE_COSTS[category] || 0);
}


// ---------- GENERATION MODIFIER ----------
function getGenerationModifier(category, generation, extras) {
    const isRedstone = category.includes("Redstone");

    if (extras.includes("Ethereal")) return 1;

    let modifier = 1;

    if (generation >= 1) {
        const capped = Math.min(generation, 4);
        modifier = Math.pow(0.5, capped - 1);
    } else {
        modifier = isRedstone ? 1 : (1 / 3);
    }

    const softeningExtras = ["Glitched", "BreedOnly", "Manual"];
    if (softeningExtras.some(e => extras.includes(e))) {
        modifier = 1 - ((1 - modifier) / 2);
    }

    return modifier;
}


// ---------- AGE CALCULATION ----------
function calculateAgeAdjusted(value, category, ageMonths) {
    const curve = AGE_CURVES[category] || AGE_CURVES["CUSTOM"];

    let adjusted = value;
    const earlyMonths = Math.min(ageMonths, 12);
    const lateMonths = Math.max(ageMonths - 12, 0);

    adjusted *= Math.pow(1 + curve.early, earlyMonths);
    adjusted *= Math.pow(1 + curve.late, lateMonths);

    return adjusted;
}


// ---------- POPULATION MODIFIER ----------
function getPopulationModifier(generation, population, extras) {
    if (generation <= 0) return 1;

    let modifier;

    if (population < 11) modifier = 1.40;
    else if (population <= 151) modifier = 1.20;
    else if (population <= 1001) modifier = 1.15;
    else if (population <= 10001) modifier = 1.05;
    else if (population <= 100001) modifier = 1.005;
    else modifier = 0.95;

    if (generation > 1 && !extras.includes("BreedOnly")) {
        modifier = 1 + ((modifier - 1) * -0.55);
    }

    return modifier;
}


// ---------- EXTRAS ----------
function calculateExtras(value, category, generation, ageMonths, extras) {
    let total = 0;

    extras.forEach(extra => {
        const rule = EXTRA_EFFECTS[extra];
        if (!rule) return;

        if (extra === "Manual" && generation < 2) return;

        if (extra === "Ungrown") {
            if (ageMonths >= 120) total += value;
            else if (ageMonths < 3) total -= value * 0.03;
            return;
        }

        const fn = rule[category] || rule.default;
        if (typeof fn === "function") total += fn(value);
    });

    return total;
}


// ---------- MARKET INFLUENCE ----------
function calculateMarketInfluence(finalValue, market) {
    const values = [];
    if (market.week > 0) values.push(market.week);
    if (market.month > 0) values.push(market.month);
    if (market.current > 0) values.push(market.current);

    if (values.length === 0) return finalValue;

    const avg = values.reduce((a, b) => a + b, 0) / values.length;

    if (values.length === 3) {
        return (finalValue * 0.20) + (avg * 0.80);
    }

    return (finalValue * 0.60) + (avg * 0.40);
}


// ===============================
//  MAIN CALCULATOR
// ===============================
function calculateValue({
    category,
    customBase,
    generation,
    birthdate,
    population,
    extras,
    market
}) {
    const baseCost = getBaseCost(category, customBase);

    const birth = new Date(birthdate);
    const now = new Date();
    const ageMonths = Math.max(
        0,
        Math.floor((now - birth) / (1000 * 60 * 60 * 24 * 30.437))
    );

    const genAdjusted = baseCost * getGenerationModifier(category, generation, extras);
    const ageAdjusted = calculateAgeAdjusted(genAdjusted, category, ageMonths);
    const populationAdjusted = ageAdjusted * getPopulationModifier(generation, population, extras);

    const extrasAdded = calculateExtras(
        populationAdjusted,
        category,
        generation,
        ageMonths,
        extras
    );

    let finalValue = populationAdjusted + extrasAdded;
    finalValue = calculateMarketInfluence(finalValue, market);

    return {
        category,
        baseCost: Math.floor(baseCost),
        generationAdjusted: Math.floor(genAdjusted),
        ageAdjusted: Math.floor(ageAdjusted),
        populationAdjusted: Math.floor(populationAdjusted),
        extrasAdded: Math.floor(extrasAdded),
        finalValue: Math.floor(finalValue)
    };
}


// ===============================
//  UI HANDLING
// ===============================
function runCalc() {
    const category   = document.getElementById("category").value;
    const customBase = Number(document.getElementById("customBase").value || 0);
    const generation = Number(document.getElementById("generation").value);
    const birthdate  = document.getElementById("birthdate").value;
    const population = Number(document.getElementById("population").value);

    const market = {
        week: Number(document.getElementById("market7").value || 0),
        month: Number(document.getElementById("market30").value || 0),
        current: Number(document.getElementById("marketCurrent").value || 0)
    };

    const extras = Array.from(
        document.querySelectorAll(".extras-grid input:checked")
    ).map(el => el.value);

    const result = calculateValue({
        category,
        customBase,
        generation,
        birthdate,
        population,
        extras,
        market
    });

    const marketValues = [];
    if (market.week > 0) marketValues.push(market.week);
    if (market.month > 0) marketValues.push(market.month);
    if (market.current > 0) marketValues.push(market.current);

    const marketSuggested = marketValues.length > 0
        ? Math.floor(marketValues.reduce((a, b) => a + b, 0) / marketValues.length)
        : result.finalValue;

    document.getElementById("output").textContent = `
Category: ${result.category}
--------------------------------
Base Value: ${result.baseCost.toLocaleString()}
Generation Adjusted: ${result.generationAdjusted.toLocaleString()}
Age Adjusted: ${result.ageAdjusted.toLocaleString()}
Population Adjusted: ${result.populationAdjusted.toLocaleString()}
Extras Added: ${result.extrasAdded.toLocaleString()}
Market Consideration: ${marketSuggested.toLocaleString()}
--------------------------------
FINAL VALUE: ${result.finalValue.toLocaleString()}
`.trim();
}


// ---------- CUSTOM CATEGORY TOGGLE ----------
function toggleCustomField() {
    const category = document.getElementById("category").value;
    const wrapper = document.getElementById("customBaseWrapper");
    wrapper.style.display = (category === "CUSTOM") ? "block" : "none";
}

document.addEventListener("DOMContentLoaded", () => {
    const categorySelect = document.getElementById("category");
    categorySelect.addEventListener("change", toggleCustomField);
    toggleCustomField();
});
</script>

<div class="box">
    <h2>How This Works</h2>

    <p>
        The Value Machine estimates a pet’s coin value based on a variety of factors.
    </p>

    <ul>
        <li><strong>Category</strong> sets the base value.</li>
        <li><strong>Generation</strong> reduces value depending on rules.</li>
        <li><strong>Age</strong> increases value over time.</li>
        <li><strong>Population</strong> adjusts value based on rarity.</li>
        <li><strong>Extras</strong> add flat bonuses or percentage-based increases.</li>
    </ul>
    <hr>
    <p style="font-size: 0.9em; color: #666;">
        <strong>Version:</strong> 1.50 | <strong>Last Updated:</strong> 01-05-2026 17:00 XST
    </p>
</div>

</body>
</html>
