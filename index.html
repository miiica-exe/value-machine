<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Value Machine</title>
<style>
    body {
        font-family: "Times New Roman", serif;
        background: black url(https://media.xanje.com/themes/dark/background.png);
        color: #b8b8b8;
        padding: 20px;
        max-width: 800px;
        margin: auto;
    }
    h1 { 
        text-align: center;
        color: #b8b8b8;
    }
    .box {
        background: #fff;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }
    label { display: block; margin-top: 10px; }
    input, select {
        background: #15212a;
        padding: 6px;
        margin-top: 3px;
        font-size: 16px;
        border: 1px solid #aaa;
    }
    .extras-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 6px;
        margin-top: 10px;
    }
    button {
        width: 100%;
        padding: 12px;
        margin-top: 20px;
        font-size: 18px;
        background: #15212a;
        color: #b8b8b8;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover { background: #222; }
    pre {
        background: #15212a;
        padding: 15px;
        border-radius: 6px;
        white-space: pre-wrap;
    }
</style>
</head>

<body>

<h1>Value Machine</h1>

<div class="box">
    <h2>Pet Value Calculator</h2>
    <label>Category</label>
<select id="category" onchange="toggleCustomField()">
    <option>Main</option>
    <option>Stray</option>
    <option>Battle</option>
    <option>Premium</option>
    <option>Seasonal</option>
    <option>Orphan</option>
    <option>Greystone</option>
    <option>Redstone</option>
    <option>Redstone(2)</option>
    <option>Redstone(4)</option>
    <option>Quest/Award</option>
    <option value="CUSTOM">Custom</option>
</select>

<!-- Hidden until Custom is selected -->
<div id="customBaseWrapper" style="display:none; margin-top:10px;">
    <label>Custom Value(coins)</label>
    <input id="customBase" type="number" value="0">
</div>


    <label>Generation <abbr title="If the pet is G1, use the G1 population from the library. Otherwise use total.">?</abbr></label>
    <input id="generation" type="number" value="1">

    <label>Age (in months)</label>
    <input id="age" type="number" value="1">

    <label>Population</label>
    <input id="population" type="number" value="100">

    <label>Extras (select any):</label>
    <div class="extras-grid">
        <label><input type="checkbox" value="Ethereal"> Ethereal <abbr title="Only applies to pets with ethereal/star attribute">?</abbr></label>
        <label><input type="checkbox" value="Event"> Special Attribute <abbr title="Pledged in crowdfunned, blessed by Yanne, kumforted, NOT for orphan effects or recolored pets">?</abbr></label>
        <label><input type="checkbox" value="Elder"> Elder <abbr title="Only applies to pets 10+ years old">?</abbr></label>
        <label><input type="checkbox" value="Painted"> Painted <abbr title="Only applies to a pet has been colored in Carrie's">?</abbr></label>
        <label><input type="checkbox" value="Glitched"> Glitched <abbr title="For most visible glitches, missing layers, etc">?</abbr></label>
        <label><input type="checkbox" value="Rare"> Rare <abbr title="Rare strays, rare coloring.">?</abbr></label>
        <label><input type="checkbox" value="AllCarrier"> All Carrier <abbr title="Only applies to pets that carry all genes">?</abbr></label>
        <label><input type="checkbox" value="Effect"> Effect <abbr title="Only applies to pets from orphan releases that have an effect">?</abbr></label>
        <label><input type="checkbox" value="Manual"> Manual Breeding <abbr title="For G2+ pets with manual breeding(Common Cat, Persian Cat, some Palace Cats, some Star Cats)">?</abbr></label>
        <label><input type="checkbox" value="Parentless"> Parentless <abbr title="Only applies to G1 pets with no found parents">?</abbr></label>
        <label><input type="checkbox" value="BreedOnly"> Breed-Only Variant <abbr title="Only applies to mutations that can only be obtained through breeding">?</abbr></label>
        <label><input type="checkbox" value="Unbreedable"> Unbreedable <abbr title="Only applies to certain older pets that have unfinished linework and cannot be bred">?</abbr></label>
    </div>

    <button onclick="runCalc()">Calculate</button>
</div>

<div class="box">
    <h2>Results</h2>
    <pre id="output">Fill in values and click Calculate.</pre>
</div>


<script>
// ===============================
//  VALUE MACHINE — CORE LOGIC
// ===============================


// ---------- CATEGORY BASE COSTS ----------
const CATEGORY_BASE_COSTS = {
    "Redstone(4)": 3200000,
    "Redstone(2)": 1600000,
    "Redstone": 800000,
    "Greystone": 600000,
    "Battle": 200000,
    "Premium": 100000,
    "Seasonal": 100000,
    "Orphan": 25000,
    "Quest/Award": 20000,
    "Main": 5000,
    "Stray": 4000
};


// ---------- EXTRA EFFECTS (CATEGORY-AWARE) ----------
const EXTRA_EFFECTS = {
    Ethereal: {
        "Redstone":     v => 4000000,
        "Redstone(2)":  v => 4500000,
        "Redstone(4)":  v => 4500000,
        "Greystone":    v => 4000000,
        "Battle":       v => 4000000,
        "Premium":      v => 4000000,
        "Seasonal":     v => 3500000,
        "Orphan":       v => 4500000,
        "Quest/Award":  v => 2500000,
        "Main":         v => 3000000,
        "Stray":        v => 3500000,
        "CUSTOM":       v => 4000000
    },
    Elder: {
        default: v => (v * 1.5) + 1500000   // adds 150% + flat
    },
    Glitched: {
        "Redstone":     v => 300000,
        "Redstone(2)":  v => 250000,
        "Redstone(4)":  v => 250000,
        "Greystone":    v => 300000,
        "Battle":       v => 400000,
        "Premium":      v => 400000,
        "Seasonal":     v => 350000,
        "Orphan":       v => 450000,
        "Quest/Award":  v => 250000,
        "Main":         v => 300000,
        "Stray":        v => 350000,
        "CUSTOM":       v => 200000
    },
    AllCarrier: {
        default: v => v * 1.0   // adds 100%
    },
    Manual: {
        default: v => v * 0.25  // +25%
    },
    BreedOnly: {
        default: v => v * 0.20, // +35%
        "CUSTOM": v => 9000
    },
    Event: {
        default: v => (v * 0.25) + 150000
    },
    Painted: {
        default: v => 500000,
        "CUSTOM": v => 250000
    },
    Rare: {
        default: v => v * 0.05, // +5%
        "Stray":  v => 10000,
        "Battle": v => 85000
    },
    Effect: {
        default: v => 0,
        "Orphan": v => (v * 0.15) + 10000
    },
    Parentless: {
        default: v => v * 0.15
    },
    Unbreedable: {
        default: v => 200000
    }
};



// ===============================
//  HELPERS
// ===============================

// Base value
function getBaseCost(category, customBase) {
    return category === "CUSTOM"
        ? customBase
        : (CATEGORY_BASE_COSTS[category] || 0);
}


// ---------- GENERATION MODIFIER ----------
function getGenerationModifier(category, generation, extras) {

    const isRedstone =
        category === "Redstone" ||
        category === "Redstone(2)" ||
        category === "Redstone(4)";

    // Ethereal ignores ALL generation penalties
    if (extras.includes("Ethereal")) {
        return 1;
    }

    // Base generation modifier
    let modifier = 1;

    // Positive generations
    if (generation >= 1) {
        const cappedGen = Math.min(generation, 4);

        // G1 = 1, G2 = 1/2, G3 = 1/4, G4+ = 1/8
        modifier = Math.pow(0.5, cappedGen - 1);
    }
    // Negative generations
    else {
        modifier = isRedstone ? 1 : (1 / 3);
    }

    // Softened penalty for certain extras
    const softeningExtras = ["Glitched", "BreedOnly", "Manual"];
    const hasSoftening = softeningExtras.some(e => extras.includes(e));

    if (hasSoftening) {
        // halve the penalty (move halfway back to 1)
        modifier = 1 - ((1 - modifier) / 2);
    }

    return modifier;
}


// ---------- POPULATION MODIFIER ----------
function getPopulationModifier(generation, population, extras) {
    if (generation <= 0) return 1;

    let modifier;

    if (population < 11) modifier = 1.30;
    else if (population <= 151) modifier = 1.10;
    else if (population <= 501) modifier = 1.075;
    else if (population <= 1001) modifier = 1.05;
    else if (population <= 10001) modifier = 1.025;
    else if (population <= 100001) modifier = 1.01;
    else if (population <= 200001) modifier = 1.009;
    else modifier = 1.0005;

    // Breed-only protects against population reduction
    if (generation > 1 && !extras.includes("BreedOnly")) {
        modifier = 1 + ((modifier - 1) * -0.55);
    }

    return modifier;
}


// ---------- EXTRAS ----------
function calculateExtras(value, category, generation, extras) {
    let total = 0;

    extras.forEach(extra => {
        const rule = EXTRA_EFFECTS[extra];
        if (!rule) return;

        // Manual restriction
        if (extra === "Manual" && generation < 2) return;

        const fn = rule[category] || rule.default;
        if (typeof fn === "function") {
            total += fn(value);
        }
    });

    return total;
}


// ===============================
//  MAIN CALCULATOR
// ===============================
function calculateValue({
    category,
    customBase,
    generation,
    ageMonths,
    population,
    extras
}) {
    const baseCost = getBaseCost(category, customBase);

    // ----- Generation -----
    const genModifier = getGenerationModifier(category, generation, extras);
    const genAdjusted = baseCost * genModifier;

    // ----- Age -----
    const monthlyRate = 0.025;
    const ageAdjusted = genAdjusted * Math.pow(1 + monthlyRate, ageMonths);

    // ----- Population -----
    const popModifier = getPopulationModifier(generation, population, extras);
    const populationAdjusted = ageAdjusted * popModifier;

    // ----- Extras -----
    const extrasAdded = calculateExtras(
        populationAdjusted,
        category,
        generation,
        extras
    );

    const finalValue = populationAdjusted + extrasAdded;

    const suggested =
        finalValue < 10000
            ? "Less than 10,000"
            : (Math.round(finalValue / 10000) * 10000).toLocaleString();

    return {
        category,
        baseCost: Math.floor(baseCost),
        generationAdjusted: Math.floor(genAdjusted),
        ageAdjusted: Math.floor(ageAdjusted),
        populationAdjusted: Math.floor(populationAdjusted),
        extrasAdded: Math.floor(extrasAdded),
        finalValue: Math.floor(finalValue),
        suggested
    };
}

// ===============================
//  UI HANDLING
// ===============================

function toggleCustomField() {
    const category = document.getElementById("category").value;
    const wrapper = document.getElementById("customBaseWrapper");

    wrapper.style.display = category === "CUSTOM" ? "block" : "none";
}

function runCalc() {
    const category   = document.getElementById("category").value;
    const customBase = Number(document.getElementById("customBase").value || 0);
    const generation = Number(document.getElementById("generation").value);
    const ageMonths  = Number(document.getElementById("age").value);
    const population = Number(document.getElementById("population").value);

    const extras = Array.from(
        document.querySelectorAll(".extras-grid input:checked")
    ).map(el => el.value);

    const result = calculateValue({
        category,
        customBase,
        generation,
        ageMonths,
        population,
        extras
    });

    document.getElementById("output").textContent = `
Category: ${result.category}
Base Value: ${result.baseCost}
Gen Adjusted: ${result.generationAdjusted}
Age Adjusted: ${result.ageAdjusted}
Population Adjusted: ${result.populationAdjusted}
Extras Added: ${result.extrasAdded}
--------------------------------
FINAL VALUE: ${result.finalValue.toLocaleString()}
Suggested: ${result.suggested}
`.trim();
}

</script>
<div class="box">
    <h2>How This Works</h2>

    <p>
        The Value Machine estimates a pet’s coin value based on a variety of factors.
    </p>

    <ul>
        <li><strong>Category</strong> sets the base value.</li>
        <li><strong>Generation</strong> reduces value depending on rules.</li>
        <li><strong>Age</strong> increases value over time.</li>
        <li><strong>Population</strong> adjusts value based on rarity.</li>
        <li><strong>Extras</strong> add flat bonuses or percentage-based increases.</li>
    </ul>

    <p>
        This tool is intended to be used for suggested prices when there
        are no others of a given type on market. 
        <br>Feel free to reach out to xanje.com/~miiica if you encounter issues.
    </p>

    <hr>

    <p style="font-size: 0.9em; color: #666;">
        <strong>Version:</strong> 1.3<br>
        <strong>Last Updated:</strong> 12-15-2025 14:00 XST
    </p>
</div>

</body>
</html>
